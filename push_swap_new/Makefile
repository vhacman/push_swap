# **************************************************************************** #
#                                                                              #
#                                                         :::      ::::::::    #
#    Makefile                                           :+:      :+:    :+:   #
#                                                     +:+ +:+         +:+     #
#    By: vhacman <vhacman@student.42roma.it>         +#+  +:+       +#+        #
#                                                 +#+#+#+#+#+   +#+            #
#    Created: 2025/03/27 13:00:00 by vhacman           #+#    #+#              #
#    Updated: 2025/03/29 10:00:00 by vhacman          ###   ########.fr        #
#                                                                              #
# **************************************************************************** #

NAME        = push_swap
CC          = gcc
CFLAGS      = -Wall -Wextra -Werror

LIBFT_DIR   = src/libft
LIBFT_A     = $(LIBFT_DIR)/libft.a
INCLUDES    = -I include -I $(LIBFT_DIR)

SRC_SUBDIRS = \
	main \
	src/algorithms/hybrid_sort \
	src/algorithms/hybrid_sort/hybrid_sort_utils \
	src/algorithms/merge_sort \
	src/algorithms/mini_sort_a \
	src/algorithms/ultra_chunk \
	src/error_handling \
	src/execute_optimal_moves \
	src/utils \
	src/utils/debug_functions \
	src/utils/stack_operations \
	src/utils/stack_operations/print_operations

SRC         = $(foreach dir,$(SRC_SUBDIRS),$(wildcard $(dir)/*.c))

OBJ_DIR     = obj
OBJ         = $(patsubst %.c,$(OBJ_DIR)/%.o,$(SRC))

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
#                              ğ“‘ğ“¾ğ“²ğ“µğ“­ ğ“£ğ“ªğ“»ğ“°ğ“®ğ“½ğ“¼                              #
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

all: $(NAME)
	@echo "âœ¨ ğ“’ğ“¸ğ“·ğ“³ğ“¾ğ“»ğ“®ğ“­ â†’ ğ“¹ğ“¾ğ“¼ğ“±_ğ“¼ğ”€ğ“ªğ“¹ ğ“²ğ“¼ ğ“»ğ“®ğ“ªğ“­ğ”‚!"

$(NAME): $(OBJ) $(LIBFT_A)
	@echo "ğŸ”§ ğ“’ğ“¸ğ“¶ğ“¹ğ“²ğ“µğ“²ğ“·ğ“– ğ“½ğ“±ğ“® ğ“¶ğ“ªğ“°ğ“²ğ“¬..."
	@$(CC) $(CFLAGS) $(INCLUDES) $(OBJ) $(LIBFT_A) -o $(NAME)

$(LIBFT_A):
	@echo "ğŸ“¦ ğ“‘ğ“¾ğ“²ğ“µğ“­ğ“²ğ“·ğ“° ğ“›ğ“²ğ“«ğ“¯ğ“½ ğ“¶ğ“¸ğ“­ğ“¾ğ“µğ“®..."
	@$(MAKE) -s --no-print-directory -C $(LIBFT_DIR)

# Compilazione file .o nella struttura obj/ parallela a src/
$(OBJ_DIR)/%.o: src/%.c
	@mkdir -p $(dir $@) # Crea la sottocartella in obj/
	@$(CC) $(CFLAGS) $(INCLUDES) -c $< -o $@

$(OBJ_DIR)/%.o: %.c
	@mkdir -p $(dir $@)
	@$(CC) $(CFLAGS) $(INCLUDES) -c $< -o $@

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
#                                ğ“’ğ“µğ“®ğ“ªğ“·ğ“²ğ“·ğ“°                                   #
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

check:
	@echo "ğŸ” ğ“¥ğ“®ğ“»ğ“²ğ“¯ğ”‚ğ“²ğ“·ğ“° ğ”€ğ“²ğ“½ğ“± ğ“¬ğ“±ğ“®ğ“¬ğ“´ğ“®ğ“»_ğ“µğ“²ğ“·ğ“¾ğ”..."
	@seq 0 99 | shuf | tr '\n' ' ' > args.txt
	@echo "ğŸ“„ ğ“ğ“»ğ“°ğ“¾ğ“¶ğ“®ğ“·ğ“½ğ“¼ ğ“¼ğ“ªğ“¿ğ“®ğ“­ ğ“½ğ“¸ args.txt:"
	@RESULT=$$(./$(NAME) $$(cat args.txt) | ./checker_linux $$(cat args.txt)); \
	echo "ğŸ“£ ğ“¡ğ“®ğ“¼ğ“¾ğ“µğ“½: $$RESULT"; \
	if [ "$$RESULT" = "OK" ]; then \
		echo "âœ… ğ“¢ğ“¾ğ“¬ğ“¬ğ“®ğ“¼ğ“¼: ğ“¼ğ“¸ğ“»ğ“½ğ“®ğ“­ ğ“¬ğ“¸ğ“»ğ“»ğ“®ğ“¬ğ“½ğ“µğ”‚!"; \
	elif [ "$$RESULT" = "KO" ]; then \
		echo "âŒ ğ“”ğ“»ğ“»ğ“¸ğ“»: ğ“·ğ“¸ğ“½ ğ“¼ğ“¸ğ“»ğ“½ğ“®ğ“­."; \
	else \
		echo "âš ï¸ ğ“¤ğ“·ğ“´ğ“·ğ“¸ğ”€ğ“· ğ“»ğ“®ğ“¼ğ“¾ğ“µğ“½: $$RESULT"; \
	fi

clean:
	@echo "ğŸ§¹ ğ“¢ğ”€ğ“®ğ“®ğ“¹ğ“²ğ“·ğ“° ğ“ğ“«ğ“³ğ“®ğ“¬ğ“½ğ“¼..."
	@rm -rf $(OBJ_DIR) # Rimuove la cartella obj e tutto il suo contenuto (file .o, sottocartelle, ecc.)
	@$(MAKE) -s --no-print-directory -C $(LIBFT_DIR) clean
	@$(RM) valgrind.log args.txt

fclean: clean
	@echo "ğŸ’£ ğ“”ğ“»ğ“ªğ“¼ğ“²ğ“·ğ“° ğ“”ğ“§ğ“®ğ“¬ğ“¾ğ“½ğ“ªğ“«ğ“µğ“®..."
	@rm -f $(NAME)
	@$(MAKE) -s --no-print-directory -C $(LIBFT_DIR) fclean
	@$(RM) valgrind.log args.txt
	@echo "ğŸºğŸ¥‚ğŸ¸ ğ“Ÿğ“¾ğ“¼ğ“± ğ“¢ğ”€ğ“ªğ“¹ ğ“¸ğ“«ğ“µğ“²ğ“½ğ“ªğ“»ğ“®ğ“½ğ“®ğ“­: ğ“¯ğ“¬ğ“µğ“®ğ“ªğ“· ğ“¬ğ“¸ğ“¶ğ“¹ğ“µğ“®ğ“½ğ“® ğŸ»ğŸ·ğŸ¹"


re: fclean all

# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #
#                      ğ“”ğ”ğ“½ğ“»ğ“ª ğ“œğ“ªğ“°ğ“²ğ“¬ (ğ“¿ğ“ªğ“µğ“°ğ“»ğ“²ğ“·ğ“­ ğ“½ğ“®ğ“¼ğ“½)                      #
# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

valgrind:
	@echo "ğŸ§  ğ“˜ğ“·ğ“²ğ“½ğ“²ğ“ªğ“µğ“²ğ“ğ“²ğ“·ğ“° ğ“¶ğ“®ğ“¶ğ“¸ğ“»ğ”‚ ğ“¼ğ“¬ğ“ªğ“· ğ“¼ğ“®ğ“ºğ“¾ğ“®ğ“·ğ“¬ğ“®..."
	@echo "ğŸ¸ ğ“”ğ“·ğ“½ğ“®ğ“»ğ“²ğ“·ğ“° ğ“½ğ“±ğ“® ğ“­ğ“®ğ“«ğ“¾ğ“° ğ“­ğ“²ğ“¶ğ“®ğ“·ğ“¼ğ“²ğ“¸ğ“·..."
	@rm -f valgrind.log
	@for i in {1..5}; do \
		ARG="$$(seq 0 49 | shuf | tr '\n' ' ')"; \
		echo "ğŸ§ª ğ“£ğ“®ğ“¼ğ“½ğ“²ğ“·ğ“° ğ”€ğ“²ğ“½ğ“± X ğ“·ğ“¾ğ“¶ğ“«ğ“®ğ“»ğ“¼..." | tee -a valgrind.log; \
		valgrind --leak-check=full ./$(NAME) $$ARG >> valgrind.log 2>&1; \
		echo "-----------------------------------------" | tee -a valgrind.log; \
	done
	@echo "ğŸ¯ ğ“œğ“²ğ“¼ğ“¼ğ“²ğ“¸ğ“· ğ“¬ğ“¸ğ“¶ğ“¹ğ“µğ“®ğ“½ğ“®: ğ“ƒğ‘œ ğ“ğ‘’ğ’¶ğ“€ğ“ˆ ğ’»ğ‘œğ“Šğ“·ğ’¹ (ğ“Œğ‘’ ğ’½ğ‘œğ“…ğ‘’) ğŸ’¥"
	@echo "ğŸ“„ ğ“›ğ“¸ğ“° ğ“¼ğ“ªğ“¿ğ“®ğ“­ ğ“½ğ“¸ â†’ valgrind.log"
	@echo "ğŸ·ğŸ·ğŸ· ğ“œğ“®ğ“¶ğ“¸ğ“»ğ”‚ ğ“¼ğ“¬ğ“ªğ“· ğ“¬ğ“¸ğ“¶ğ“¹ğ“µğ“®ğ“½ğ“® ğŸ¾ğŸ¾ğŸ¾"

.PHONY: all clean fclean re valgrind
